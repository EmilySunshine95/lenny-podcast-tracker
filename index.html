<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Podcast Radar</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #fffaf0;
      --bg-deep: #fef3c7;
      --ink: #1f2937;
      --muted: #6b7280;
      --card: #ffffff;
      --line: #e5e7eb;
      --hot: #ea580c;
      --shadow: 0 10px 30px rgba(31, 41, 55, 0.09);
      --radius-lg: 20px;
      --radius-md: 14px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: "Manrope", sans-serif;
      background:
        radial-gradient(circle at 12% 18%, rgba(251, 146, 60, 0.28), transparent 34%),
        radial-gradient(circle at 88% 8%, rgba(56, 189, 248, 0.18), transparent 28%),
        linear-gradient(180deg, var(--bg) 0%, #fff 70%);
      color: var(--ink);
      min-height: 100vh;
      line-height: 1.6;
    }

    .hero {
      padding: 52px 20px 28px;
      text-align: center;
    }

    .hero .eyebrow {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1.4px;
      color: #9a3412;
      font-weight: 800;
      margin-bottom: 8px;
    }

    .hero h1 {
      font-family: "Space Grotesk", sans-serif;
      font-size: clamp(30px, 6vw, 50px);
      line-height: 1.08;
      letter-spacing: -0.03em;
      margin-bottom: 10px;
    }

    .hero .tagline {
      color: #92400e;
      font-size: 15px;
      max-width: 720px;
      margin: 0 auto;
    }

    .meta-info {
      margin-top: 16px;
      font-size: 13px;
      color: var(--muted);
    }

    .shell {
      max-width: 1180px;
      margin: 0 auto;
      padding: 0 20px 54px;
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 20px;
    }

    .panel {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
    }

    .left-col {
      display: flex;
      flex-direction: column;
      gap: 16px;
      position: sticky;
      top: 16px;
      height: fit-content;
    }

    .block-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: var(--muted);
      font-weight: 800;
      margin-bottom: 10px;
    }

    .category-panel,
    .podcast-list-panel {
      padding: 16px;
    }

    .category-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .category-chip {
      border: 1px solid #fed7aa;
      background: #fff7ed;
      color: #9a3412;
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      cursor: pointer;
      transition: 0.2s ease;
    }

    .category-chip.active {
      background: #ea580c;
      color: #fff;
      border-color: #ea580c;
    }

    .podcast-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 480px;
      overflow: auto;
      padding-right: 4px;
    }

    .podcast-item {
      border: 1px solid var(--line);
      border-radius: 12px;
      background: #fff;
      text-align: left;
      width: 100%;
      padding: 10px 12px;
      cursor: pointer;
      transition: 0.2s ease;
    }

    .podcast-item:hover {
      border-color: #fdba74;
      transform: translateY(-1px);
    }

    .podcast-item.active {
      border-color: var(--accent, #ea580c);
      box-shadow: 0 0 0 2px color-mix(in oklab, var(--accent, #ea580c), #fff 75%);
    }

    .podcast-item .name {
      font-weight: 700;
      font-size: 14px;
      line-height: 1.35;
      color: #111827;
    }

    .podcast-item .sub {
      margin-top: 2px;
      font-size: 12px;
      color: var(--muted);
    }

    .main-col {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .podcast-header {
      padding: 18px;
      display: flex;
      justify-content: space-between;
      gap: 16px;
      align-items: flex-start;
      border: 1px solid color-mix(in oklab, var(--accent, #ea580c), #fff 72%);
      background: linear-gradient(120deg, color-mix(in oklab, var(--accent, #ea580c), #fff 90%), #fff);
    }

    .podcast-header h2 {
      font-family: "Space Grotesk", sans-serif;
      font-size: clamp(24px, 4vw, 34px);
      line-height: 1.1;
      letter-spacing: -0.02em;
      margin-bottom: 8px;
    }

    .podcast-meta {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .meta-pill {
      display: inline-block;
      font-size: 12px;
      font-weight: 700;
      padding: 5px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.78);
      border: 1px solid rgba(0, 0, 0, 0.08);
      color: #7c2d12;
    }

    .podcast-blurb {
      font-size: 14px;
      color: #374151;
      max-width: 780px;
    }

    .yt-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border-radius: 999px;
      padding: 9px 14px;
      text-decoration: none;
      background: #ef4444;
      color: #fff;
      font-size: 13px;
      font-weight: 800;
      white-space: nowrap;
      transition: 0.2s ease;
      border: 1px solid #dc2626;
    }

    .yt-btn:hover { transform: translateY(-1px); background: #dc2626; }

    .episodes-panel { padding: 16px; }

    .episodes {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 10px;
    }

    .episode-card {
      border: 1px solid #f3f4f6;
      border-radius: var(--radius-md);
      background: #fff;
      padding: 14px;
      transition: 0.2s ease;
    }

    .episode-card:hover {
      border-color: color-mix(in oklab, var(--accent, #ea580c), #fff 70%);
      box-shadow: 0 8px 24px rgba(2, 6, 23, 0.07);
      transform: translateY(-1px);
    }

    .ep-top {
      display: grid;
      grid-template-columns: 96px 1fr auto;
      gap: 12px;
      align-items: start;
    }

    .ep-thumb {
      width: 96px;
      height: 96px;
      border-radius: 12px;
      object-fit: cover;
      border: 1px solid #e5e7eb;
      background: #f3f4f6;
    }

    .ep-title {
      font-size: 16px;
      line-height: 1.4;
      font-weight: 800;
      color: #111827;
    }

    .ep-title a {
      color: inherit;
      text-decoration: none;
    }

    .ep-title a:hover { color: var(--accent, #ea580c); }

    .ep-date {
      font-size: 12px;
      color: #6b7280;
      white-space: nowrap;
      margin-top: 2px;
      font-weight: 700;
    }

    .ep-meta {
      display: flex;
      gap: 7px;
      margin: 10px 0 10px 108px;
      flex-wrap: wrap;
    }

    .ep-tag {
      font-size: 11px;
      font-weight: 700;
      padding: 4px 10px;
      border-radius: 999px;
      background: #f3f4f6;
      color: #4b5563;
      border: 1px solid #e5e7eb;
    }

    .ep-desc {
      margin-left: 108px;
      font-size: 14px;
      color: #374151;
      line-height: 1.7;
      white-space: pre-line;
    }

    .toggle-en {
      margin-left: 108px;
      margin-top: 8px;
      background: none;
      border: none;
      color: #9a3412;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      padding: 0;
    }

    .toggle-en:hover { text-decoration: underline; }

    .en-text {
      display: none;
      margin-left: 108px;
      margin-top: 8px;
      padding: 10px 12px;
      border-radius: 10px;
      background: #f9fafb;
      border: 1px dashed #d1d5db;
      font-size: 13px;
      color: #6b7280;
      line-height: 1.7;
      white-space: pre-line;
    }

    .en-text.show { display: block; }

    .verdict-bar {
      margin-left: 108px;
      margin-top: 10px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .v-btn {
      font-size: 12px;
      font-weight: 700;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #fff;
      color: #6b7280;
      padding: 5px 11px;
      cursor: pointer;
    }

    .v-btn.want.active { background: #dcfce7; border-color: #22c55e; color: #166534; }
    .v-btn.maybe.active { background: #fef3c7; border-color: #f59e0b; color: #92400e; }
    .v-btn.skip.active { background: #fee2e2; border-color: #ef4444; color: #991b1b; }

    .loading, .error {
      text-align: center;
      padding: 40px 18px;
      color: #6b7280;
      font-size: 14px;
    }

    .stats {
      margin-top: 18px;
      text-align: center;
      font-size: 12px;
      color: #6b7280;
    }

    @media (max-width: 980px) {
      .shell {
        grid-template-columns: 1fr;
      }

      .left-col {
        position: static;
      }

      .podcast-list {
        max-height: 240px;
      }

      .ep-top {
        grid-template-columns: 78px 1fr;
      }

      .ep-date {
        grid-column: 2;
      }

      .ep-thumb {
        width: 78px;
        height: 78px;
      }

      .ep-meta,
      .ep-desc,
      .toggle-en,
      .en-text,
      .verdict-bar {
        margin-left: 0;
      }
    }
  </style>
</head>
<body>
  <header class="hero">
    <div class="eyebrow">Commute Podcast Tracker</div>
    <h1>Podcast Radar</h1>
    <div class="tagline">按主题筛选你关心的播客，快速看清每期内容，再决定今天通勤听什么。</div>
    <div class="meta-info" id="meta-info">Loading...</div>
  </header>

  <main class="shell">
    <aside class="left-col">
      <section class="panel category-panel">
        <div class="block-title">Categories</div>
        <div class="category-list" id="category-list"></div>
      </section>

      <section class="panel podcast-list-panel">
        <div class="block-title">Podcasts</div>
        <div class="podcast-list" id="podcast-list"></div>
      </section>
    </aside>

    <section class="main-col">
      <section class="panel podcast-header" id="podcast-header"></section>
      <section class="panel episodes-panel">
        <div class="block-title">Latest Episodes</div>
        <div class="episodes" id="episodes">
          <div class="loading">Loading episodes...</div>
        </div>
        <div class="stats" id="stats"></div>
      </section>
    </section>
  </main>

  <script>
    const VERDICTS_KEY = "podcast_radar_verdicts";
    let DATA = null;
    let ACTIVE_CATEGORY = "All";
    let ACTIVE_PODCAST_ID = null;

    function loadVerdicts() {
      try {
        return JSON.parse(localStorage.getItem(VERDICTS_KEY) || "{}");
      } catch {
        return {};
      }
    }

    function saveVerdict(key, verdict) {
      const current = loadVerdicts();
      if (current[key] === verdict) delete current[key];
      else current[key] = verdict;
      localStorage.setItem(VERDICTS_KEY, JSON.stringify(current));
      return current;
    }

    function esc(value) {
      const d = document.createElement("div");
      d.textContent = value || "";
      return d.innerHTML;
    }

    function formatDate(dateStr) {
      const d = new Date(dateStr);
      if (Number.isNaN(d.getTime())) return "recent";
      const now = new Date();
      const diff = Math.floor((now - d) / 86400000);
      if (diff === 0) return "today";
      if (diff === 1) return "yesterday";
      if (diff < 7) return `${diff}d ago`;
      return d.toLocaleDateString("en-US", { month: "short", day: "numeric" });
    }

    function formatDuration(mins) {
      if (!mins) return "";
      const h = Math.floor(mins / 60);
      return h > 0 ? `${h}h ${mins % 60}m` : `${mins}m`;
    }

    function allCategories() {
      const set = new Set(["All"]);
      for (const p of DATA.podcasts || []) set.add(p.category || "Other");
      return Array.from(set);
    }

    function filteredPodcasts() {
      const all = DATA.podcasts || [];
      if (ACTIVE_CATEGORY === "All") return all;
      return all.filter((p) => (p.category || "Other") === ACTIVE_CATEGORY);
    }

    function ensureActivePodcast() {
      const list = filteredPodcasts();
      if (list.length === 0) {
        ACTIVE_PODCAST_ID = null;
        return;
      }
      if (!ACTIVE_PODCAST_ID || !list.some((p) => p.id === ACTIVE_PODCAST_ID)) {
        ACTIVE_PODCAST_ID = list[0].id;
      }
    }

    function currentPodcast() {
      return (DATA.podcasts || []).find((p) => p.id === ACTIVE_PODCAST_ID) || null;
    }

    function renderCategories() {
      const el = document.getElementById("category-list");
      el.innerHTML = allCategories().map((cat) => `
        <button class="category-chip ${cat === ACTIVE_CATEGORY ? "active" : ""}"
          onclick="switchCategory('${esc(cat)}')">${esc(cat)}</button>
      `).join("");
    }

    function renderPodcastList() {
      const el = document.getElementById("podcast-list");
      const list = filteredPodcasts();
      if (list.length === 0) {
        el.innerHTML = '<div class="error">No podcasts in this category.</div>';
        return;
      }

      el.innerHTML = list.map((p) => `
        <button class="podcast-item ${p.id === ACTIVE_PODCAST_ID ? "active" : ""}"
          style="--accent:${p.color || "#ea580c"}"
          onclick="switchPodcast('${esc(p.id)}')">
          <div class="name">${esc(p.name)}</div>
          <div class="sub">${esc(p.subtitle || "")}</div>
        </button>
      `).join("");
    }

    function renderPodcastHeader() {
      const p = currentPodcast();
      const el = document.getElementById("podcast-header");

      if (!p) {
        el.innerHTML = '<div class="error">No podcast selected.</div>';
        return;
      }

      el.style.setProperty("--accent", p.color || "#ea580c");
      el.innerHTML = `
        <div>
          <h2>${esc(p.name)}</h2>
          <div class="podcast-meta">
            <span class="meta-pill">${esc(p.category || "Other")}</span>
            <span class="meta-pill">${esc(p.host || "")}</span>
            <span class="meta-pill">${esc(p.subtitle || "")}</span>
          </div>
          <div class="podcast-blurb">${esc(p.blurb || "")}</div>
        </div>
        <a class="yt-btn" href="${p.youtube || "#"}" target="_blank" rel="noopener">Watch Channel</a>
      `;
    }

    function renderEpisodes() {
      const p = currentPodcast();
      const el = document.getElementById("episodes");

      if (!p) {
        el.innerHTML = '<div class="error">No podcast selected.</div>';
        return;
      }

      if (!p.episodes || p.episodes.length === 0) {
        el.innerHTML = '<div class="error">No episodes found for this podcast yet.</div>';
        updateStats();
        return;
      }

      const verdicts = loadVerdicts();
      el.innerHTML = p.episodes.map((ep, i) => {
        const key = `${p.id}::${ep.title}`.replace(/'/g, "\\'").replace(/"/g, "&quot;");
        const verdict = verdicts[`${p.id}::${ep.title}`] || "";
        return `
          <article class="episode-card">
            <div class="ep-top">
              <img class="ep-thumb" src="${ep.artworkUrl || ""}" alt="cover" loading="lazy" onerror="this.style.display='none'">
              <div>
                <div class="ep-title">
                  ${ep.url ? `<a href="${ep.url}" target="_blank" rel="noopener">${esc(ep.title)}</a>` : esc(ep.title)}
                </div>
              </div>
              <div class="ep-date">${formatDate(ep.date)}</div>
            </div>

            <div class="ep-meta">
              ${ep.duration ? `<span class="ep-tag">${formatDuration(ep.duration)}</span>` : ""}
            </div>

            <div class="ep-desc">${esc(ep.descriptionCN || ep.description || "")}</div>

            <button class="toggle-en" onclick="toggleEn(${i})">Show original / 显示原文</button>
            <div class="en-text" id="en-${i}">${esc(ep.description || "")}</div>

            <div class="verdict-bar">
              <button class="v-btn want ${verdict === "want" ? "active" : ""}" onclick="setVerdict('${key}','want',this)">Want</button>
              <button class="v-btn maybe ${verdict === "maybe" ? "active" : ""}" onclick="setVerdict('${key}','maybe',this)">Maybe</button>
              <button class="v-btn skip ${verdict === "skip" ? "active" : ""}" onclick="setVerdict('${key}','skip',this)">Skip</button>
            </div>
          </article>
        `;
      }).join("");

      updateStats();
    }

    function switchCategory(category) {
      ACTIVE_CATEGORY = category;
      ensureActivePodcast();
      renderAll();
    }

    function switchPodcast(id) {
      ACTIVE_PODCAST_ID = id;
      renderAll();
    }

    function toggleEn(i) {
      const box = document.getElementById(`en-${i}`);
      if (box) box.classList.toggle("show");
    }

    function setVerdict(key, verdict, btn) {
      const verdicts = saveVerdict(key, verdict);
      const bar = btn.parentElement;
      bar.querySelectorAll(".v-btn").forEach((b) => b.classList.remove("active"));
      if (verdicts[key]) btn.classList.add("active");
      updateStats();
    }

    function updateStats() {
      const verdicts = loadVerdicts();
      const want = Object.values(verdicts).filter((x) => x === "want").length;
      const maybe = Object.values(verdicts).filter((x) => x === "maybe").length;
      const skip = Object.values(verdicts).filter((x) => x === "skip").length;
      document.getElementById("stats").textContent =
        `${want} want · ${maybe} maybe · ${skip} skip · Auto-updates daily at 07:00 Beijing time`;
    }

    function renderAll() {
      renderCategories();
      renderPodcastList();
      renderPodcastHeader();
      renderEpisodes();
    }

    async function init() {
      try {
        const res = await fetch("data/episodes.json");
        if (!res.ok) throw new Error("No data");
        DATA = await res.json();

        const d = new Date(DATA.lastFetched);
        document.getElementById("meta-info").textContent =
          `Last updated: ${d.toLocaleString("zh-CN", { hour12: false })}`;

        ACTIVE_CATEGORY = "All";
        ensureActivePodcast();
        renderAll();
      } catch {
        document.getElementById("meta-info").textContent = "Data unavailable";
        document.getElementById("episodes").innerHTML =
          '<div class="error">No episode data yet. Please run the fetch workflow first.</div>';
      }
    }

    init();
  </script>
</body>
</html>
